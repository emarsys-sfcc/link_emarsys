!function(e){var t={};function a(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=t,a.d=function(e,t,s){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(s,n,function(t){return e[t]}.bind(null,n));return s},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=2)}([function(e,t,a){"use strict";e.exports=function(e,t){var a=$(".js-notification-message");if(e){var s=$(".js-"+e+"-message");a.removeClass("js-d-flex"),$(s).addClass("js-d-flex"),t&&(a.find(".js-body-"+e+"-message").text(""),$(s).find(".js-body-"+e+"-message").text(t)),$("body,html").animate({scrollTop:0},250)}else a.removeClass("js-d-flex"),a.find(".js-body-"+e+"-message").text("")}},,function(e,t,a){"use strict";var s=a(0),n=a(3);function r(e){return"SFCC_"+e.replace(/[-\s]+/g,"_").replace(/([a-z])([A-Z])/g,"$1_$2").toUpperCase()}function o(e,t){var a=$(".js-page-data-block .js-"+e+"-events .js-emarsys-name-select").clone();if(null!=t){var s=a.find('[value="'+t+'"]');a.prepend(s),s.prop("selected",!0)}return a}function i(){var e=$(".js-notification-messages").data("server-error");s("error",e),setTimeout((function(){s()}),5e3)}function c(e,t){var a=$(".js-page-data-block .js-"+t+"-events .js-emarsys-name-select").children('[value="'+e.emarsysName+'"]');a.attr("data-emarsys-id",e.emarsysId),a.attr("data-campaign-id",e.campaignId),$(".js-"+t+"-events-table .js-emarsys-name-select").filter(":not(:disabled)").each((function(){var e=$(this).children(":first").attr("value"),a=o(t,e),s=$(".js-emarsys-select-data").data("option-cancel-title");a.children(":first").text(s),a.val($(this).val()),$(this).replaceWith(a)}))}function l(e,t){var a=$(".js-page-data-block .js-"+t+"-events").data("emarsys-descriptions"),s={event:e,index:a.length};a.some((function(e,t){var a=e.emarsysName===this.event.emarsysName;return a&&(this.index=t),a}),s),a.splice(s.index,1,e)}e.exports={processEmptyTableNotifications:function(){function e(e){0===$(".js-"+e+"-events-table .js-external-events-row").length&&$(".js-"+e+"-events-table .js-empty-table-notification").removeClass("hide-content")}e("subscription"),e("other")},initAddEventDialog:function(){n.init({dialogSelector:".js-page-data-block .js-add-event-dialog",openCallback:function(){var e=this.dialog,t=$(".js-"+this.eventType+"-events .js-sfcc-name-select").clone(),a=e.find(".js-sfcc-name-select");a.children(":first").insertBefore(t.children(":first")),t.children(":first").prop("selected",!0),a.replaceWith(t);var s=e.find(".js-emarsys-name-select");if("subscription"===this.eventType){var r=o(this.eventType);r.prepend(s.children(":first")),r.children('[value=""]').remove(),r.children(":first").prop("selected",!0),s.replaceWith(r)}else e.find(".js-emarsys-name-select").addClass("hide-content");n.applyReplacementsList(e,this.replaceList),n.open(e)},closeCallback:function(){var e=this.dialog;n.close(e),s();var t=e.find(".js-emarsys-name-select option").filter(":selected"),a=e.find(".js-sfcc-name-select option").filter(":selected");return{eventType:this.eventType,event:{emarsysId:t.attr("data-emarsys-id"),emarsysName:t.attr("value"),sfccName:a.attr("value")}}}})},initAddEventButtons:function(){function e(e){var t=!0;if(0===$(".js-page-data-block .js-"+e+"-events .js-sfcc-name-select").find("option[value]").length){var a=$(".js-notification-messages").data("empty-source-error");s("error",a),setTimeout((function(){s()}),1e4),t=!1}return t}function t(e){var t=$(e),a={newRow:t.find(".js-external-events-row"),requestBodyExample:t.find(".js-supported-events-data").data("request-example"),triggerForm:t.find(".js-trigger-form"),error:t.find(".js-request-error").data("error")};if(a.newRow){var n,r={emarsysId:a.newRow.attr("data-emarsys-id"),emarsysName:a.newRow.attr("data-emarsys-name"),sfccName:a.newRow.attr("data-sfcc-name"),campaignId:a.newRow.find(".js-campaign-status").data("id"),campaignStatus:a.newRow.find(".js-campaign-status").data("status")},o=this.eventType,i=$(".js-page-data-block .js-"+o+"-events").data("campaigns");if(i[r.emarsysId]?i[r.emarsysId].status=r.campaignStatus:i[r.emarsysId]={id:r.campaignId,status:r.campaignStatus},"new"===r.emarsysStatus&&"other"!==o&&c(r,o),$(".js-page-data-block .js-"+o+"-events .js-sfcc-name-select").children('[value="'+r.sfccName+'"]').remove(),$(".js-"+o+"-events-table .js-empty-table-notification").addClass("hide-content"),a.newRow.insertBefore($(".js-"+o+"-events-table .js-empty-table-notification")),a.requestBodyExample&&a.requestBodyExample.length)$(".js-page-data-block .js-"+o+"-events").data("request-examples")[r.emarsysName]=a.requestBodyExample;a.triggerForm&&a.triggerForm.length&&$(".js-page-data-block .js-"+o+"-forms").append(a.triggerForm),l(r,o);var d=$(".js-notification-messages");n=d.data("success-event")+r.sfccName+d.data("success-created"),s("success",n)}else a.error&&"ERROR"===a.error.message&&s("error",a.error.message)}function a(e){if(e&&"cancel"!==e.status){var a="",n=e.data.eventType,o=e.data.event;if(!o.sfccName)return a=$(".js-notification-messages").data("empty-name-error"),s("error",a),void setTimeout((function(){s()}),5e3);if("appropriate"===o.emarsysName){o.emarsysName=r(o.sfccName);var c=$(".js-page-data-block .js-"+n+"-events .js-emarsys-name-select").children('[value="'+o.emarsysName+'"]');o.emarsysId=c.attr("data-emarsys-id")}var l=$(".js-page-data-block .js-"+n+"-events").data("campaigns")[o.emarsysId],d={type:n,sfccName:o.sfccName,emarsysId:o.emarsysId,emarsysName:o.emarsysName,campaignId:l&&l.id,campaignStatus:l&&l.status};$.ajax({url:$(".js-page-links").data("urls").addEvent,type:"post",dataType:"text",data:d,context:{eventType:n},success:t,error:i})}}$(".js-add-subscription-event-button").on("click",{dialogPopup:n,userResponseHandler:a,checkSfccNameOptions:e},(function(e){var t=e.data;t.checkSfccNameOptions("subscription")&&n.getUserResponse({dialogSelector:".js-add-event-dialog",eventType:"subscription",replaceList:[{selector:".js-dialog-title",text:$(".js-dialog-messages").data("add-subscription")}]}).then(t.userResponseHandler)})),$(".js-add-other-event-button").on("click",{dialogPopup:n,userResponseHandler:a,checkSfccNameOptions:e},(function(e){var t=e.data;t.checkSfccNameOptions("other")&&n.getUserResponse({dialogSelector:".js-add-event-dialog",eventType:"other",replaceList:[{selector:".js-dialog-title",text:$(".js-dialog-messages").data("add-other")}]}).then(t.userResponseHandler)}))},initChangeButtons:function(){function e(e,t){var a=$(".js-button-labels").data("apply");t.text(a),t.removeClass("js-change-button"),t.addClass("js-apply-changes-button");var n=t.closest(".js-external-events-row"),i=n.find(".js-emarsys-name-select"),c=o(e,i.children(":selected").attr("value"));if("other"===e){var l=r(n.attr("data-sfcc-name"));c.children(':not([value="'+l+'"],[value=""])').remove()}var d=$(".js-emarsys-select-data").data("option-cancel-title");c.children(":first").text(d),i.replaceWith(c),s()}$(".js-subscription-events-table").on("click",".js-change-button",{changeEvent:e},(function(e){e.data.changeEvent("subscription",$(e.target))})),$(".js-other-events-table").on("click",".js-change-button",{changeEvent:e},(function(e){e.data.changeEvent("other",$(e.target))}))},initApplyButton:function(){function e(){var e=$(".js-button-labels").data("change");this.updateButton.text(e),this.updateButton.removeClass("js-apply-changes-button"),this.updateButton.addClass("js-change-button");var t=this.row.find(".js-emarsys-name-select"),a=t.children(":first"),s=$(".js-page-data-block .js-"+this.eventType+"-events .js-emarsys-name-select").children('option[value="'+this.prevEmarsysName+'"]').clone(),n=t.children(":selected").attr("value");a.replaceWith(s),t.val(n),t.prop("disabled",!0),this.updateButton.prop("disabled",!1)}function t(e){if(e.response&&"OK"===e.response.status){var t,a=e.response.result.event,n=e.response.result.campaigns;"new"===a.emarsysStatus&&"other"!==this.eventType&&c(a,this.eventType),this.row.find(".js-emarsys-name-select").children('[value="'+a.emarsysName+'"]').prop("selected",!0),this.row.attr("data-emarsys-id",a.emarsysId),this.row.attr("data-emarsys-name",a.emarsysName),$(".js-page-data-block .js-"+this.eventType+"-events").data("campaigns")[a.emarsysId].status=n[a.emarsysId].status,l(a,this.eventType);var r=$(".js-notification-messages");t=r.data("success-event")+a.sfccName+r.data("success-changed"),s("success",t)}else e.response&&"ERROR"===e.response.status&&s("error",e.response.message)}function a(a,s){var n=s.closest(".js-external-events-row"),r=n.find(".js-emarsys-name-select").find("option").filter(":selected"),o=r.attr("value"),c=r.attr("data-emarsys-id"),l=n.attr("data-emarsys-name"),d={eventType:a,row:n,updateButton:s,prevEmarsysName:l};if(o!==l){var p=$(".js-page-data-block .js-"+a+"-events").data("campaigns"),u={type:a,sfccName:n.attr("data-sfcc-name"),emarsysId:c,emarsysName:o,campaignId:p[c].id,campaignStatus:p[c].status};s.prop("disabled",!0),$.ajax({url:$(".js-page-links").data("urls").updateEvent,type:"post",dataType:"json",data:u,context:d,success:t,error:i,complete:e})}else e.call(d)}$(".js-subscription-events-table").on("click",".js-apply-changes-button",{applyChanges:a},(function(e){e.data.applyChanges("subscription",$(e.target))})),$(".js-other-events-table").on("click",".js-apply-changes-button",{applyChanges:a},(function(e){e.data.applyChanges("other",$(e.target))}))},initRequestBodyExampleDialog:function(){n.init({dialogSelector:".js-page-data-block .js-request-body-example",openCallback:function(){var e=this.dialog,t=$(".js-page-data-block .js-"+this.eventType+"-events").data("request-examples")[this.emarsysEventName],a="";a=t?JSON.stringify(t,null,2):$(".js-page-data-block .js-dialog-messages").data("unsupported-event"),e.find(".js-content-block pre").text(a),n.applyReplacementsList(e,this.replaceList),n.open(e)}})},initRequestBodyExampleButton:function(){function e(e,t){var a=t.closest(".js-external-events-row"),r=a.attr("data-sfcc-name"),o=a.attr("data-emarsys-name");n.getUserResponse({dialogSelector:".js-request-body-example",eventType:e,emarsysEventName:o,replaceList:[{selector:".js-dialog-title",text:$(".js-dialog-messages").data("show-example")+' "'+r+'"'}]}),s()}$(".js-subscription-events-table .js-example-button").on("click",{showRequestBodyExample:e},(function(e){e.data.showRequestBodyExample("subscription",$(e.target))})),$(".js-other-events-table .js-example-button").on("click",{showRequestBodyExample:e},(function(e){e.data.showRequestBodyExample("other",$(e.target))}))},initTriggerEventDialog:function(){n.init({dialogSelector:".js-page-data-block .js-trigger-event",openCallback:function(){var e=this.dialog,t=e.find(".dialog-content-block");t.children().remove(),t.append(this.formTemplate),n.applyReplacementsList(e,this.replaceList),n.open(e)},closeCallback:function(){var e=this.dialog;n.close(e),s();var t=e.find(".js-content-block .js-input-fields"),a={};return Array.prototype.forEach.call(t,(function(e){this.formData[$(e).attr("name")]=$(e).val()}),{formData:a}),{eventType:this.eventType,formData:a,event:this.event}}})},initTriggerEventButton:function(){function e(e){e.response&&"OK"===e.response.status?s("success","The event was successfully triggered"):e.response&&"ERROR"===e.response.status&&s("error",e.response.message)}function t(t){if(t&&"cancel"!==t.status){var a=t.data.eventType,s=t.data.formData,n=t.data.event,r={type:a,sfccName:n.sfccName,emarsysId:n.emarsysId,emarsysName:n.emarsysName,campaignId:n.emarsysName,formData:JSON.stringify(s)};$.ajax({url:$(".js-page-links").data("urls").triggerEvent,type:"post",dataType:"json",data:r,context:{eventType:a},success:e,error:i})}}function a(e,a){var r=a.closest(".js-external-events-row"),o={emarsysId:r.attr("data-emarsys-id"),emarsysName:r.attr("data-emarsys-name"),sfccName:r.attr("data-sfcc-name"),campaignId:r.attr("data-campaign-id")},i=$(".js-page-data-block .js-"+e+"-forms").find('[data-event-name="'+o.sfccName+'"]')[0];i&&(n.getUserResponse({dialogSelector:".js-trigger-event",eventType:e,event:o,formTemplate:$(i).clone(),replaceList:[{selector:".js-dialog-title",text:$(".js-dialog-messages").data("trigger-event")+' "'+o.sfccName+'"'}]}).then(t),s())}$(".js-subscription-events-table .js-trigger-button").on("click",{triggerEvent:a},(function(e){e.data.triggerEvent("subscription",$(e.target))})),$(".js-other-events-table .js-trigger-button").on("click",{triggerEvent:a},(function(e){e.data.triggerEvent("other",$(e.target))}))},initRefreshStatusButtons:function(){function e(e){if(e.response&&"OK"===e.response.status){var t=e.response.eventType,a=e.response.campaigns;$(".js-page-data-block .js-"+t+"-events").data("campaigns",a),$(".js-"+t+"-events-table .js-external-events-row").each((function(){var e=$(this).attr("data-emarsys-id"),t=$(this).find(".js-campaign-status");t.data("emarsys-id",a[e].id),t.data("emarsys-status",a[e].status),t.text(a[e].status)})),s("success",'Statys for "'+t+'" event campaigns was successfully refreshed')}else e.response&&"ERROR"===e.response.status&&s("error",e.response.message)}function t(t){var a=$(".js-page-data-block .js-"+t+"-events").data("emarsys-descriptions"),s={type:t,descriptions:JSON.stringify(a)};$.ajax({url:$(".js-page-links").data("urls").campaignStatus,type:"post",dataType:"json",data:s,context:{eventType:t},success:e,error:i})}$(".js-refresh-status-subscription").on("click",{refreshStatus:t},(function(e){e.data.refreshStatus("subscription",$(e.target))})),$(".js-refresh-status-other").on("click",{refreshStatus:t},(function(e){e.data.refreshStatus("other",$(e.target))}))}}},function(e,t,a){"use strict";function s(e){e.parent().removeClass("hidden-block")}function n(e){e.parent().addClass("hidden-block"),l(e)}function r(e,t){var a=null;return t.dialog?t.dialog instanceof jQuery?a=t.dialog:t.dialog instanceof HTMLElement&&(a=$(t.dialog),$.extend(t,{dialog:a})):t.dialogSelector&&(a=e.find(t.dialogSelector).first()),a}function o(e){var t=e.data,a=t.arguments,s=null;a.closeCallback?s=a.closeCallback(t):n(a.dialog),t.promiseResolve({status:t.status,data:s})}function i(e){var t=e.arguments,a=null;t.closeCallback?a=t.closeCallback(e):n(t.dialog),e.promiseResolve({status:e.status,data:a})}function c(e){var t=e.data;"Enter"===e.code?i({status:"confirm",promiseResolve:t.promiseResolve,arguments:t.arguments}):"Escape"===e.code&&i({status:"cancel",promiseResolve:t.promiseResolve,arguments:t.arguments}),e.preventDefault()}function l(e){var t=e.parent();e.off("click"),t.off("click"),$(document.body).off("keyup",c)}e.exports={init:function(e){var t=r($(document.body),e);if(!t||!t.length)return null;e.dialog||(t=t.clone(),$.extend(e,{dialog:t}));var a=$("<div>",{class:"js-dialog-wrapper dialog-wrapper hidden-block"});a.append(t),a.data(e);var s=$(".js-dialog-container").first();return s.length||(s=$("<div>",{class:"js-dialog-container dialog-container"}),$(document.body).append(s)),s.append(a),t},getUserResponse:function(e){var t=r($(".js-dialog-container").first(),e);if(!t.length)return Promise.resolve();var a=function(e,t){var a=e.parent().data(),s=Object.create(a);return $.extend(s,t),s}(t,e);return new Promise((function(e){var n={arguments:a,promiseResolve:e};a.openCallback?a.openCallback(n):s(t),function(e,t){var a=e.parent();e.on("click",".js-confirm-button",$.extend({},t,{status:"confirm"}),o),e.on("click",".js-cancel-button,.js-close-button",$.extend({},t,{status:"cancel"}),o),a.on("click",$.extend({},t,{status:"cancel"}),o),e.on("click",(function(e){e.stopPropagation()})),$(document.body).on("keyup",$.extend({},t),c)}(t,n)}))},open:s,close:n,detach:function(e){return e.parent().detach()},removeEventHandlers:l,applyReplacementsList:function(e,t){t&&t.forEach((function(e){this.find(e.selector).text(e.text)}),e)}}}]);